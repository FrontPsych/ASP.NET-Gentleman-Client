@using Domain.Identity
@using Microsoft.AspNet.Identity
@using Microsoft.AspNet.Identity.Owin
@using Web.Helpers
@{
    UserInt user = HttpContext.Current.GetOwinContext().GetUserManager<ApplicationUserManager>().FindById(int.Parse(User.Identity.GetUserId()));

    var culture = CultureHelper.GetCurrentUICulture().ToLower();

    var nameValueCollection = HttpUtility.ParseQueryString(Request?.Url?.Query ?? "");
    nameValueCollection.Remove("culture");
    string returnUrl = Request?.Url?.AbsolutePath + "?" + nameValueCollection;

    //var returnUrl = Request.Url?.PathAndQuery ?? "";

}
<nav class="navbar navbar-static-top">
    <!-- Sidebar toggle button-->
    <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
    </a>
    <div class="navbar-custom-menu">
        <ul class="nav navbar-nav">
            <!-- User Account: style can be found in dropdown.less -->
            <li class="dropdown user user-menu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    <img src="/Images/DefaultProfile.png" class="user-image" alt="User Image">
                    <span class="hidden-xs">@user.PersonName</span>
                </a>
                <ul class="dropdown-menu">
                    <!-- User image -->
                    <li class="user-header">
                        <img src="/Images/DefaultProfile.png" class="img-circle" alt="User Image">
                        <p>
                            @user.PersonName
                            <small>@Resources.Common.MemberSince @user.RegisterDate.Date.ToShortDateString()</small>
                        </p>
                    </li>
                    @*<!-- Menu Body -->
                    <li class="user-body">
                        <div class="row">
                            <div class="col-xs-4 text-center">
                                <a href="#">Followers</a>
                            </div>
                            <div class="col-xs-4 text-center">
                                <a href="#">Sales</a>
                            </div>
                            <div class="col-xs-4 text-center">
                                <a href="#">Friends</a>
                            </div>
                        </div>
                        <!-- /.row -->
                    </li>*@
                    <!-- Menu Footer-->
                    @using (Html.BeginForm("LogOff", "Account", new { area = "" }, FormMethod.Post, new { id = "logoutForm"}))
                    {
                        @Html.AntiForgeryToken()
                        <li class="user-footer">
                            <div class="pull-left">
                                <a class="btn btn-default btn-flat" href="#">@Resources.Common.Settings</a>
                            </div>
                            <div class="pull-right">
                                <a class="btn btn-default btn-flat" href="javascript:document.getElementById('logoutForm').submit()">@Resources.Common.LogOff</a>
                            </div>
                        </li>
                    }
                </ul>
            </li>

            <!-- Language Toggle Button -->
            <li class="dropdown user user-menu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-language"></i></a>
                <ul class="dropdown-menu">

                    <!-- Menu Footer-->
                    <li>
                        <ul class="list-inline">
                            <li>
                                <img class="flag flag-et" />
                            </li>
                            <li>
                                @Html.ActionLink(Resources.Common.Estonian, "SetLanguage", new { area = "", controller = "Language", culture = "et", returnUrl }, htmlAttributes: new { id = "langLinkEst" })
                            </li>
                        </ul>
                    <li>
                    <li>
                        <ul class="list-inline">
                            <li>
                                <img class="flag flag-en" />
                            </li>
                            <li>
                                @Html.ActionLink(Resources.Common.English, "SetLanguage", new { area = "", controller = "Language", culture = "en", returnUrl }, htmlAttributes: new { id = "langLinkEng" })
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</nav> 
